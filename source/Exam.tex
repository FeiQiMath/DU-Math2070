\documentclass{article}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{amscd}
\usepackage{amsfonts}
\usepackage{mathrsfs}
\usepackage{stmaryrd}
\usepackage{longtable}
\usepackage{cancel}
\usepackage{soul}
\usepackage{xcolor}

\usepackage{tikz}
\usepackage{pgf,tikz,pgfplots}
\pgfplotsset{compat=1.14}
\definecolor{ffffff}{rgb}{1,1,1}
\definecolor{ffff00}{rgb}{1,1,0}


\usetikzlibrary{arrows}
\usepackage[T1]{fontenc}
\usepackage[normalem]{ulem}
\allowdisplaybreaks





\newcommand{\nord}{\mbox{\scriptsize ${\circ\atop\circ}$}}


\setcounter{tocdepth}{1}

\usepackage{bbm}

%\allowdisplaybreaks

\theoremstyle{definition}
\newtheorem{theorem}{Theorem}[section]

\newtheorem{thm}[theorem]{Theorem}
\newtheorem{prop}[theorem]{Proposition}

\newtheorem{defn}[theorem]{Definition}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{cor}[theorem]{Corollary}
\newtheorem{prop-def}{Proposition-Definition}[section]
\newtheorem{claim}{Claim}[section]
\newtheorem{rema}[theorem]{Remark}
\newtheorem{propprop}{Proposed Proposition}[section]
\newtheorem{conjecture}{Conjecture}
\newtheorem{exam}[theorem]{Example}
\newtheorem{nota}[theorem]{Notation}
\newtheorem{assumption}{Assumption}
\newtheorem{condition}[theorem]{Assumption}
\newtheorem{summ}[theorem]{Summary}


\newcommand{\R}{{\mathbb R}}
\newcommand{\N}{{\mathbb N}}
\newcommand{\C}{{\mathbb C}}
\newcommand{\Z}{{\mathbb Z}}
\newcommand{\F}{{\mathbb F}}
\newcommand{\Q}{{\mathbb Q}}
\newcommand{\h}{{\mathfrak h}}
\newcommand{\g}{{\mathfrak g}}
\newcommand{\Y}{{\mathcal Y}}


\newcommand{\LRA}{\Leftrightarrow}
\newcommand{\Hom}{\textrm{Hom}}
\newcommand{\End}{\textrm{End}}
\newcommand{\Aut}{\textrm{Aut}}
\newcommand{\Gal}{\textrm{Gal}}
\newcommand{\Der}{\textrm{Der}}
\newcommand{\ORA}{\overrightarrow}
\newcommand{\one}{\mathbf{1}}
\renewcommand{\d}{\mathbf{d}}
\newcommand{\wt}{\mbox{\rm wt}\ }
\newcommand{\tr}{\textrm{Tr }}
\newcommand{\otimesdots}{\otimes \cdots \otimes}
\newcommand{\sltwohat}{\widehat{\mathfrak{sl}_2}}
\newcommand{\Res}{\text{Res}}
\newcommand{\Hol}{\text{Hol}}
\newcommand{\Sym}{\text{Sym}}

\renewcommand\thefootnote{\textcolor{red}{\arabic{footnote}}}


\usepackage{scalerel,stackengine}
\stackMath
\newcommand\reallywidehat[1]{%
\savestack{\tmpbox}{\stretchto{%
  \scaleto{%
    \scalerel*[\widthof{\ensuremath{#1}}]{\kern-.6pt\bigwedge\kern-.6pt}%
    {\rule[-\textheight/2]{1ex}{\textheight}}%WIDTH-LIMITED BIG WEDGE
  }{\textheight}% 
}{0.5ex}}%
\stackon[1pt]{#1}{\tmpbox}%
}
\parskip 1ex


\textheight 23.2cm \textwidth 16cm \topmargin -0.8cm

\begin{document}

\setlength{\oddsidemargin}{0cm} \setlength{\evensidemargin}{0cm}
\baselineskip=18pt


\title{Foundational computations}


\maketitle

\section{Rank-1 formulas}

Let $\mathfrak{h}$ be the one-dimensional vector space $\C h$ with $\langle h, h\rangle = 2$. We identify $\mathfrak{h}$ with $\mathfrak{h}^*$. View $\mathfrak{h}$ as an abelian Lie algebra, let $\hat{\mathfrak{h}}$ be its affinization. The Heisenberg VOA of level $l$ is then built upon the vector space $S(\hat\h_-)$, with the conformal element given by 
$$\omega_\h = \frac 1 {2l} \left(\frac 1 2 h(-1)h(-1)\one
\right) = \frac 1 {4l} h(-1)h(-1)\one.$$
For $\alpha\in \h^*$, let $W_\lambda$ be the Heisenberg module generated by a  vacuum vector $w_\lambda$, i.e., 
$$h(m)w_\lambda =0, m>0. \quad h(0) w_\lambda = \langle \lambda, h\rangle w_\lambda. \quad k w_\lambda = l w_\lambda. \quad W_\lambda = S(\hat\h_-)\otimes w_\lambda. $$
Then the $L_\h(0)$-weight of $w_\lambda$ is $\frac 1 {2l}\langle \lambda, \lambda\rangle.$

Our aim is to use the knowledge of Heisenberg intertwining operators to understand and construct the $\text{Ext}^1$-group of two modules for the affine $sl_2$ VOA with level $l$. We shall use the standard notation of $e,f,h$, with 
$$[h,e]=2e,[h,f]=-2f,[e,f]=h,\langle e,f\rangle = 1, \langle h, h\rangle = 2. $$
For future generalizations, we also use $\alpha$ and $e_\alpha$ for the root and the root vector in $\g$. 

\subsection{$E^+$ and $E^-$ formulas} %For every Heisenberg module with $l=1$ and $\alpha \in \h$, define 
% \begin{align*}
%     E^+(\alpha, x)&=\exp(A_+(x)) =\exp\left(\sum_{n>0} \frac{\alpha(n)}{n}x^{-n}\right)\\
%     E^-(\alpha, x)&=\exp(A_-(x)) =\exp\left(\sum_{n<0} \frac{\alpha(n)}{n}x^{-n}\right)
% \end{align*}
% Then 
% \begin{enumerate}
%     \item $E^\pm(0, x) = 1$, $E^\pm(\alpha+\beta, x) = E^\pm(\alpha, x)E^\pm (\beta, x)$, $\alpha, \beta \in \h$. 
%     \item For $h, \alpha \in \h, m \in \Z$, 
%     \begin{align*}
%         & [h(m), E^+(\alpha, x)]= 0 & \text{ if }m\geq 0. \\
%         & [h(m), E^+(\alpha, x)]= -\langle h, \alpha\rangle x^m E^+(\alpha, x) &\text{ if } m<0. \\
%         & [h(m), E^-(\alpha, x)]= -\langle h, \alpha\rangle x^m E^+(\alpha, x) &\text{ if } m\geq 0. \\        
%         & [h(m), E^-(\alpha, x)]= 0 & \text{ if }m< 0. 
%     \end{align*}
% \end{enumerate}
% We will work out the level-$l$ corrections in detail. 
For a Heisenberg module with level $l$ and $\alpha\in \h$, we define 
\begin{align*}
    E^+(\alpha, x)&=\exp\left(\frac 1 l A_+(x)\right) =\exp\left(\frac 1 l \sum_{n>0} \frac{\alpha(n)}{n}x^{-n}\right)\\
    E^-(\alpha, x)&=\exp\left(\frac 1 l A_-(x)\right) =\exp\left(\frac 1 l \sum_{n<0} \frac{\alpha(n)}{n}x^{-n}\right)
\end{align*}
Then 
\begin{enumerate}
    \item $E^\pm(0, x) = 1$, $E^\pm(\alpha+\beta, x) = E^\pm(\alpha, x)E^\pm (\beta, x)$, $\alpha, \beta \in \h$. 
    \item For $h, \alpha \in \h, m \in \Z$, 
    \begin{align*}
        & [h(m), E^+(\alpha, x)]= 0 & \text{ if }m\geq 0. \\
        & [h(m), E^+(\alpha, x)]= -\langle h, \alpha\rangle x^m E^+(\alpha, x) &\text{ if } m<0. \\
        & [h(m), E^-(\alpha, x)]= -\langle h, \alpha\rangle x^m E^-(\alpha, x) &\text{ if } m> 0. \\        
        & [h(m), E^-(\alpha, x)]= 0 & \text{ if }m\leq 0. 
    \end{align*}
    \item For $\alpha, \beta\in \h^*$, 
    $$E^+(\alpha, x_1)E^-(\beta, x_2) = E^-(\beta, x_2)E^+(\alpha, x_1) \left(1-\frac {x_2}{x_1}\right)^{\frac{\langle \alpha, \beta\rangle}{l}}. $$
\end{enumerate}
(1) is trivial. The vanishing part of (2) is trivial. Consider the commutator $[h(m), A_-]$. For $m>0$, 
\begin{align*}
    [h(m), A_-(x)] = \left[h(m), \sum_{n\in \Z_-} \frac{\alpha(n)}n x^{-n}\right] = \sum_{n\in \Z_-} \frac{1}{n} m\cdot l\cdot \langle h, \alpha\rangle \delta_{m+n} x^{-n} = -l \langle h, \alpha\rangle x^{-m}. 
\end{align*}
Therefore, 
\begin{align*}
    \left[h(m), \frac 1 l A_-(x)\right] = -\langle h, \alpha\rangle x^m. 
\end{align*}
Then from the derivation of an exponential series
$$[h(m), E^-(\alpha, x)] = \left[h(m), \exp\left(\frac 1 l A_-(x)\right)\right] = \exp\left(\frac 1 l A_-(x)\right)\left[h(m), \frac 1 l A_-(x)\right] = -\langle h, \alpha\rangle x^m E^-(\alpha, x)$$
(3) follows from a simplified version of Baker-Campbell-Hausdorff formula. We first consider 
\begin{align*}
    \left[A_+(x_1), B_-(x_2)\right] &= \left[\sum_{n>0} \frac{\alpha(n)}{n}x_1^{-n}, \sum_{m<0}\frac{\beta(m)}{m}x_2^{-m}\right] = \sum_{n>0} \frac{n l \langle \alpha, \beta\rangle}{-n^2} x_1^{-n}x_2^n \\
    &= l \langle \alpha, \beta\rangle \left(-\sum_{n>0} \frac 1 n \left(\frac {x_2}{x_1}\right)^n \right)= l\langle \alpha, \beta\rangle \log\left(1-\frac{x_2}{x_1}\right). 
\end{align*}
Therefore, 
$$\left[\frac 1 l A_+(x_1), \frac 1 l B_-(x_2)\right] = \frac{\langle \alpha, \beta\rangle}{l} \log\left(1-\frac{x_2}{x_1}\right). $$
Therefore, 
\begin{align*}
    \exp\left(\frac 1 l A_+(x_1)\right) \exp\left(\frac 1 l B_-(x_2)\right) &= \exp\left(\frac 1 l B_-(x_2)\right)\exp\left(\frac 1 l A_+(x_1)\right) \exp\left(\left[\frac 1 l A_+(x_1), \frac 1 l B_-(x_2)\right]\right)\\
    &= \exp\left(\frac 1 l B_-(x_2)\right)\exp\left(\frac 1 l A_+(x_1)\right) \left(1-\frac{x_2}{x_1}\right)^{\frac{\langle \alpha, \beta\rangle}{l}}. 
\end{align*}

\subsection{Some important commutators} For $a\in sl_2$, we shall use the notation 
$$a^{+}(x)=\sum_{n\geq 0}a(n)x^{-n-1}, a^-(x)=\sum_{n<0}a(n)x^{-n-1}. $$
Then, with the convention of binomial expansion, 
\begin{enumerate}
    \item $[a^+(x), b(y)] = [a,b](y)(x-y)^{-1}+l\langle a, b\rangle (x-y)^{-2}$. 
    \item $[a^-(x), b(y)] = [a,b](y)(y-x)^{-1}-l\langle a, b\rangle (y-x)^{-2}$. 
\end{enumerate}



For (1), 
\begin{align*}
    LHS = \ & \sum_{m\geq 0, n\in \Z} [a(m),b(n)]x^{-m-1}y^{-n-1} \\
    = \ & \sum_{m\geq 0, n\in \Z} [a,b](m+n) x^{-m-1}y^{-n-1} + \sum_{m\geq 0, n\in \Z} m l \langle a, b\rangle \delta_{m+n, 0}x^{-m-1} y^{-n-1}\\
    = \ & \sum_{n\in \Z} [a,b](n)y^{-n-1}\sum_{m\geq 0} x^{-m-1}y^m + \sum_{m\geq 0} m l \langle a, b\rangle x^{-m-1}y^{m-1} \\
    = \ & [a,b](y) \cdot \frac{x^{-1}}{1-x^{-1}y} + l \langle a, b \rangle \cdot \partial_{y} \sum_{m\geq 0} y^m x^{-m-1} \\
    = \ & [a,b](y) (x-y)^{-1} + l\langle a, b\rangle \partial_y (x-y)^{-1} = RHS. 
\end{align*}
For (2), 
\begin{align*}
    LHS = \ & \sum_{m \leq -1, n\in \Z} [a(m),b(n)]x^{-m-1}y^{-n-1} \\
    = \ & \sum_{m \leq -1, n\in \Z} [a,b](m+n) x^{-m-1}y^{-n-1} + \sum_{m \leq -1, n\in \Z} m l \langle a, b\rangle \delta_{m+n, 0}x^{-m-1} y^{-n-1}\\
    = \ & \sum_{n\in \Z} [a,b](n)y^{-n-1}\sum_{m \leq -1} x^{-m-1}y^m + \sum_{m\leq -1} m l \langle a, b\rangle x^{-m-1}y^{m-1} \\
    = \ & [a,b](y) \cdot \frac{y^{-1}}{1-y^{-1}x} + l \langle a, b \rangle \cdot \partial_{y} \sum_{m \leq -1} y^m x^{-m-1} \\
    = \ & [a,b](y) (y-x)^{-1} + l\langle a, b\rangle \partial_y (y-x)^{-1} = RHS. 
\end{align*}

Consequently, we have
\begin{enumerate}
    \item $[e^+(x), f(y)] = l (x-y)^{-2} + h(y) (x-y)^{-1}. $
    \item $[h^+(x), f(y)] = -2f(y) (x-y)^{-1}.$
    \item $[e(x), h^-(y)] = -2e(x) (x-y)^{-1}.$
    \item $[f(x), e^-(y)] = l (x-y)^{-2} + h(x) (x-y)^{-1}.$
\end{enumerate}


Another set of commutator formula is concerning $e(x)$ and $E^-(-h, x)$ and $E^-(h, x)$. We shall do this in a slightly more general context: let $e_\alpha$ be the root vector associated to the root $\alpha$. Let $\beta$ be another root. Then $$e_\alpha(x)E^-(\beta,y) = \left(1-\frac y x\right)^{\frac{-\langle \alpha, \beta\rangle}{l}}E^-(\beta,y)e_\alpha(x)$$
To show this identity, we again let $A^-(y) = \frac 1 l \sum_{n\geq 1} \frac{\beta(-n)}{-n}y^{n}$. Then 
\begin{align*}
    [e_\alpha(x), A^-(y)] = \ & \frac 1 l\sum_{m\in \Z, n \geq 1} \frac 1 {-n}[e_\alpha(m), \beta(-n)] x^{-m-1}y^n\\
    =\ &\frac 1 l \sum_{m\in \Z, n \geq 1} \frac 1 {n} \langle \alpha, \beta\rangle e_\alpha(m+n) x^{-m-1}y^n \\
    =\ & \frac 1 le_\alpha(x)\cdot \langle \alpha, \beta\rangle \sum_{n\geq 1} \frac 1 n y^n x^{-n}\\
    = \ & \frac 1 le_\alpha(x) \cdot \left(-\langle \alpha, \beta\rangle \right)\ln\left(1-\frac y x\right) = e_\alpha(x) \ln\left(1-\frac y x\right)^{-\frac {\langle \alpha, \beta\rangle} l}. 
\end{align*}
The conclusion then follows from exponentiating both sides. 

So in particular, 
\begin{align*}
    e(x)E^-(h,y) &= \left(1- \frac y x\right)^{-\frac 2 l}E^-(h,x)e(x), \\
    e(x)E^-(-h,y) &= \left(1- \frac y x\right)^{\frac 2 l}E^-(h,x)e(x),\\
    f(x)E^-(h,y) &= \left(1- \frac y x\right)^{\frac 2 l}E^-(h,x)f(x), \\
    f(x)E^-(-h,y) &= \left(1- \frac y x\right)^{-\frac 2 l}E^-(h,x)f(x)
\end{align*}

\subsection{Heisenberg vacuum vectors} Let $W$ be a generalized Verma module generated by the highest weight vector $w^{(0)}$ in the top space. Necessarily, $w^{(0)}$ itself is a Heisenberg vacuum vector. 

\begin{prop}
    The coefficients of the series
    $$E^-(h, y_1)\cdots E^-(h,y_r) E^-(-h, y_{r+1}) \cdots E^-(-h, y_{r+s}) e(y_1)\cdots e(y_r) f(y_{r+1}) \cdots f(y_{r+s})w^{(0)}$$
    are all vacuum vectors. 
\end{prop}

\begin{proof}
    This follows from the commutator formula 
    $$[h(m), E^-(\alpha, y)]=-\langle h, \alpha\rangle x^m E^-(\alpha, y)$$ 
    and 
    $$[h(m), e_\alpha(x)] = \langle h, \alpha\rangle x^m e_\alpha(x)$$
    for each $m>0$. 
\end{proof}

\begin{nota}
    For simplicity, we use the notation $e[m_1, ..., m_\alpha]f[m_{\alpha+1}, ..., m_{\alpha+\beta}]$ for the coefficient of $y_1^{-m_1-1}\cdots y_{\alpha+\beta}^{-m_{\alpha+\beta}-1}$ in the series. 
\end{nota}

\begin{prop}
    The set 
    $$\{e[-m_1, ..., -m_r]f[-m_{r+1}, ..., -m_{r+s}]: m_1 \geq \cdots m_{r}\geq -1, m_{r+1}\geq \cdots \geq m_{r+s}\geq 0\}$$
    spans the space of Heisenberg vacuum vectors. 
\end{prop}

\begin{proof}
    From the PBW theorem, $W$ is spanned by the elements 
    $$h(-p_1)\cdots h(-p_t) e(-m_1)\cdots e(-m_r)f(-m_{r+1})\cdots f(-m_{r+s})w^{(0)}$$
    as $r,s,t\in \N, p_1, .., p_t, m_1, ..., m_r \in \Z_+, m_{r+1}, ..., m_{r+s}\in \N$. Thus $W$, as a Heisenberg module, is the sum of the Heisenberg modules generated by 
    \begin{align*}
        & e(-m_1)\cdots e(-m_r)f(-m_{r+1})\cdots f(-m_{r+s})w^{(0)}\\
        \ = & \Res_{y_1, ..., y_{r+s}=0} y_1^{-m_1}\cdots y_{r+s}^{-m_{r+s}} e(y_1) \cdots e(y_r) f(y_{r+1})\cdots f(y_{r+s})w^{(0)}\\
        \ = & \Res_{y_1, ..., y_{r+s}=0} y_1^{-m_1}\cdots y_{r+s}^{-m_{r+s}} E^-(h,y_1)\cdots E^-(h,y_r)E^-(-h,y_{r+1}) \cdots E^-(-h,y_{r+s})\\
        &\qquad \qquad  \cdot \sum_{n_1, ..., n_{r+s}\in \Z}e[n_1, ..., n_{r}] f[n_{r+1}, ..., n_{r+s}] y_1^{-n_1-1}\cdots y_{r+s}^{-n_{r+s}-1} \\
        \ = & e[-m_1, ..., m_{r+1}]f[-m_{r+1}, ..., m_{r+s}]  \\
        & + \sum_{\substack{0\leq r'\leq r,\\ 0\leq s'<s}}\sum_{n_1+\cdots + n_{r'+s'}<m_1+\cdots +m_{r+s}} P^{r',s'}_{n_1,...,n_{r'+s'}}(h(-1), h(-2), \cdots) e[-n_1, ..., -n_{r'}]f[-n_{r'+1}, ..., -n_{r'+s'}]. 
    \end{align*}
    where $P^{r',s'}_{n_1,...,n_{r'+s'}}(h(-1), h(-2), \cdots)$ is a polynomial in the operators $h(-1), h(-2), ...$. Therefore, $W$ is the (direct) sum of Heisenberg modules generated by $e[-m_1, ..., -m_{r}]f[-m_{r+1}, ..., -m_{r+s}]$. Such vectors then span the space of Heisenberg vacuum vectors. 
\end{proof}

\begin{rema}
    There is a similar result in \cite{Li-Abel-Coset} formulated by $Z$-operators. 
    Set     
    \begin{align*}
        Z(e,x) &= E^-(h, x) e(x) E^+(h, x) = \sum_{m\in \Z} Z(e, m)x^{-m-1}\\
        Z(f,x) &= E^-(-h, x) f(x) E^+(-h, x) \sum_{m\in \Z} Z(f, m)x^{-m-1}
    \end{align*}
    (note that the $1/l$-factor is already compressed in the $E^-$- and $E^+$-notation). Then it is well known that the space of Heisenberg vacuum vectors are spanned by 
    $$Z(e, m_1) \cdots Z(e, m_r) Z(f, m_{r+1}) \cdots Z(f, m_{r+s})w^{(0)}.$$
\end{rema}

\subsection{Action of vertex operators on the Heisenberg vacuum vectors} We calculate the action of $e(x)$ and $f(x)$ on each vacuum vector. The action of $e(x)$ is easy.
\begin{align*}
    & e(x) e[-m_1, ..., -m_r]f[-m_{r+1}, ..., -m_{r+s}] \\
    = \ & e(x) \Res_{y_1, ...,  y_{r+s} = 0} \prod_{i=1}^r y_i^{-m_i} \prod_{i=r+1}^{r+s} y_i^{-m_i} \\
    & \qquad \qquad \cdot E^-(h, y_1) \cdots E^-(h, y_{m_r}) E^-(-h, y_{r+1}) \cdots E^-(-h, y_{r+s})e(y_1) \cdots e(y_r) f(y_{r+1}) \cdots f(y_s)\\
    = \ & \Res_{y_1, ...,  y_{r+s} = 0} \prod_{i=1}^{r}y_i^{-m_i} \left(1-\frac y x\right)^{-2/l} \prod_{i=r+1}^{r+s}y_i^{-m_i} \left(1-\frac y x\right)^{2/l} \\
    & \qquad \qquad \cdot E^-(h, y_1) \cdots E^-(h, y_{m_r}) E^-(-h, y_{r+1}) \cdots E^-(-h, y_{r+s})e(x)e(y_1) \cdots e(y_r) f(y_{r+1}) \cdots f(y_s)\\
    = \ & \Res_{y_1, ...,  y_{r+s} = 0} \prod_{i=1}^{r}\sum_{k_i=0}^\infty (-1)^{k_i} \binom{-2/l}{k_i} y^{k_i-m_i}x^{-k_i} \prod_{i=1}^{r}\sum_{k_i=0}^\infty (-1)^{k_i} \binom{2/l}{k_i} y^{k_i-m_i}x^{-k_i}  \\
    & \qquad \qquad \cdot E^-(h, y_1) \cdots E^-(h, y_{m_r}) E^-(-h, y_{r+1}) \cdots E^-(-h, y_{r+s})e(x)e(y_1) \cdots e(y_r) f(y_{r+1}) \cdots f(y_s)\\
    = \ & \sum_{k_1, ..., k_{r+s} = 0}^\infty (-1)^{k_1+\cdots + k_{r+s}} x^{-k_1-\cdots -k_{r+s}} \binom{-2/l}{k_1}\cdots \binom{-2/l}{k_r} \binom{2/l}{k_{r+1}}\cdots \binom{2/l}{k_{r+s}} \\
    & \qquad \qquad \cdot E^-(-h, x) \sum_{m\in \Z} e[m, k_1-m_1, ..., k_r-m_r]f[k_{r+1}-m_{r+1}, ..., k_{r+s}-m_{r+s}] x^{-m-1}
\end{align*}
The action of $f(x)$, on the other hand, will be complicated. 
\begin{align*}
    & f(x)e[-m_1, ..., -m_r]f[-m_{r+1}, ..., -m_{r+s}] \\
    = \ & f(x) \Res_{y_1, ...,  y_{r+s} = 0} \prod_{i=1}^r y_i^{-m_i} \prod_{i=r+1}^{r+s} y_i^{-m_i} \\
    & \qquad \qquad \cdot E^-(h, y_1) \cdots E^-(h, y_{m_r}) E^-(-h, y_{r+1}) \cdots E^-(-h, y_{r+s})e(y_1) \cdots e(y_r) f(y_{r+1}) \cdots f(y_s)\\
    = \ & \Res_{y_1, ...,  y_{r+s} = 0} \prod_{i=1}^{r}y_i^{-m_i} \left(1-\frac y x\right)^{2/l} \prod_{i=r+1}^{r+s}y_i^{-m_i} \left(1-\frac y x\right)^{-2/l} \\
    & \qquad \qquad \cdot E^-(h, y_1) \cdots E^-(h, y_{m_r}) E^-(-h, y_{r+1}) \cdots E^-(-h, y_{r+s})f(x)e(y_1) \cdots e(y_r) f(y_{r+1}) \cdots f(y_s)\\
\end{align*}
\textcolor{red}{Finish this part. }

\section{The Wanted Intertwining operators}

We are aiming to find Heisenberg intertwining operator $\Y$ of type $\binom{W_2}{VW_1}$ satisfying 

\begin{enumerate}
    \item $L(0)$-conjugation property
$$a^{L(0)}\Y(v,x)a^{-L(0)} = \Y(a^{L(0)}v, ax).$$
    \item A technical composability condition. A preliminary version is that for every $a,b\in \mathfrak{g}$, $w_1\in W_1$
    $$Y_{W_2}(a(-1)\one, z_1) \Y(b(-1)\one, z_2) w_1 \text{ and } \Y(a(-1)\one, z_1) Y_{W_1}(b(-1)\one, z_2) w_1 $$
    both converge in the region $|z_1|>|z_2|>0$ to a $\overline{W_2}$-valued rational function with poles at $z_1=0, z_2=0$ and $z_1=z_2$. In particular, the analytic continuation of these series should be single-valued functions. 
    \item The cocycle equation. For every $a, b\in \mathfrak{g}, w_1\in W_1$, 
    \begin{align*}
        & E(\Y(Y_V(a(-1)\one, z_0)b(-1)\one, z_2)w_1) \\
        = \ & E(Y_{W_2}(a(-1)\one, z_1) \Y(b(-1)\one, z_2) w_1) + E(\Y(a(-1)\one, z_1) Y_{W_1}(b(-1)\one, z_2) w_1).
    \end{align*}
\end{enumerate}

\subsection{A single intertwining operator does not work}
In case $l=1$, it is well known that the intertwining operator associated with the Heisenberg vacuum vector $e_\alpha(-1)\one$ is of the form 
$$\bar{\Y}(e_\alpha(-1)\one, x) = E^-(-\alpha, x)E^+(-\alpha, x) (e_\alpha(-1)\one)_0 x^{\alpha}$$
Here to avoid confusion, for the action of the Heisenberg vaccum vector $e_\alpha(-1)\one$ over the vacuum space, we replaced the notation $e_\alpha$ by $(e_\alpha(-1)\one)_0$. 

For generic level $l$, the formula should be corrected as
$$\bar{\Y}(e_\alpha(-1)\one, x) = E^-(-\alpha, x)E^+(-\alpha, x) (e_\alpha(-1)\one)_0 x^{\alpha(0)/l}$$
For every $\lambda\in \h^*$, the above $\Y$ gives rise to an intertwining operator of type $\binom{W_{\alpha+\lambda}}{W_\alpha W_\lambda}$, with  
$$e_\alpha \cdot (u\otimes e_\lambda) = u\otimes e_{\alpha+\lambda}, u\in S(\hat\h_-).$$

We investigate these conditions on a single Heisenberg intertwining operator, i.e., $(e_\alpha(-1)\one)$ sends each Heisenberg vacuum vector  $w_\lambda^{(1)} \in W_1$ to a \textbf{single} Heisenberg vaccum vector $w_{\lambda+2}^{(2)}\in W_2$, formally, 
$$(e_\alpha(-1)\one)_0 w_\lambda^{(1)} = w_{\lambda+\alpha}^{(2)}.$$
To meet (1), it suffices to correct the series by a power of $x$ with
$$\Y(v, x) = x^{L(0)-L_h(0)} \bar\Y(x^{-L(0)+L_h(0)}v, x)x^{-L(0)+L_h(0)}$$
In particular, if we specialize $v=e_\alpha(-1)\one$, then since $$L(0)e_\alpha(-1)\one = e_\alpha(-1)\one, L_h(0)e_\alpha(-1)\one = \frac 1 {2l}\cdot \langle \alpha, \alpha\rangle e_\alpha(-1)\one, $$
and $L(0)-L_h(0)$ commutes with $E^-(-h, x)$ and $E^+(-h,x)$, we have
$$\Y(e_\alpha(-1)\one, x) = x^{-1+\langle\alpha,\alpha\rangle/2l} E^-(-\alpha,x)E^+(-\alpha,x)x^{L(0)-L_h(0)}(e_\alpha)_0 x^{-L(0)+L_h(0)+\alpha(0)/l}. $$
Recall also that 
$$[L_h(0), e_\alpha]=e_\alpha \cdot \left(\frac 1 l \alpha(0)+\frac 1 {2l} \langle \alpha, \alpha\rangle \right).$$
Exponentiate $L_h(0)$, we have
$$x^{L_h(0)}(e_\alpha)_0 x^{-L_h(0)} = e_\alpha x^{\alpha(0)/l + \langle \alpha, \alpha\rangle / 2l}.$$
Therefore, 
$$\Y(e_\alpha(-1)\one, x) = x^{-1} E^-(-\alpha,x)E^+(-\alpha,x)x^{L(0)}(e_\alpha(-1)\one)_0 x^{-L(0)}. $$
In particular, we have
\begin{align*}
    \Y(e(-1)\one, x) &= x^{-1} E^-(-h,x)E^+(-h,x)x^{L(0)}(e(-1)\one)_0 x^{-L(0)}. \\
    \Y(f(-1)\one, x) & = x^{-1} E^-(h,x)E^+(h,x)x^{L(0)}(f(-1)\one)_0 x^{-L(0)}. 
\end{align*}
However, in case $\langle \alpha, \beta\rangle/l$ is not an integer, (2) cannot be met. Indeed, for every root $\alpha, \beta$ and a fixed $w_{\lambda}^{(1)}$,
\begin{align*}
    & Y_{W_2}(e_\alpha(-1)\one, z_1) \Y(e_\beta(-1)\one, z_2)w_\lambda^{(1)} \\
    = \ & e_\alpha(z_1) \cdot z_2^{-1} E^-(-\beta, z_2) E^+(-\beta, z_2) z_2^{L(0)}(e_\beta(-1)\one)_0 z_2^{-L(0)} w_\lambda^{(1)}\\
    = \ & e_\alpha(z_1) \cdot E^-(-\beta, z_2) w_{\lambda+\beta}^{(2)} z_2^{\text{wt}(w_{\lambda+\beta}^{(2)}) - \text{wt}(w_\lambda^{(1)})-1} \\
    = \ &  \left(1-\frac {z_2}{z_1}\right)^{\langle\alpha, \beta\rangle / l}\cdot E^-(-\beta, z_2) e_\alpha(z_1)w_{\lambda+\beta}^{(2)} z_2^{\text{wt}(w_{\lambda+\beta}^{(2)}) - \text{wt}(w_\lambda^{(1)})-1} 
\end{align*}
The series $E^-(-\beta, z_2) e_\alpha(z_1)w_{\lambda+\beta}^{(2)}$ is lower-truncated in both $z_1$ and $z_2$. So any nonzero pairing with $w_2' \in W_2$ will end up with a multi-value function. 
\begin{rema}
    In case $\g=sl_2$, we have the following observations:
    \begin{enumerate}
        \item $\langle \alpha, \beta\rangle / l$ is either $2/l$ or $-2/l$. If $2/l\in \Z$, the powers are integral, thus we end up with a meromorphic function. 
        \item However, I am not sure if the $N$-weight-degree condition holds. It clearly fails if $|2/l|>2$. For $|2/l|=1$ and $|2/l|=2$, the condition might still hold (not computed yet). 
        \item Aside from level 1 and level 2, a mechanism is necessary to remove the $2/l$-power. 
    \end{enumerate}
\end{rema}

\subsection{Ansatz with infinitely many intertwining operators}

Our ansatz for the intertwining operator will then be modified as follows: instead of requiring $(e_\alpha(-1)\one)_0 w_\lambda^{(1)}$ to consist of one or finitely many weight vectors, we will require that 
$$(e_\alpha(-1)\one)_0 w_\lambda^{(1)} = \sum_{r, s\geq 0}\sum_{n_1, ..., n_r \geq 1}\sum_{n_{r+1}, ..., n_{r+s} \geq 0}C_{w_\lambda^{(1)}}^{n_1...n_r, n_{r+1}...n_{r+s}}e[-n_1, ..., -n_r]f[-n_{r+1}, ..., n_{r+s}]w_2^{(0)}$$
where $w_2^{(0)}$ is the highest weight vector in the top space, and $wt_h(w_2^{(0)})+r-s = \lambda + \alpha$. 
So 
\begin{align*}
    & \Y(e_\alpha(-1)\one, x)w_\lambda^{(1)} \\
    = \ & \sum_{r, s\geq 0}\sum_{n_1, ..., n_r \geq 1}\sum_{n_{r+1}, ..., n_{r+s} \geq 0} E^-(-\alpha, x) \cdot C_{w_\lambda^{(1)}}^{n_1...n_r, n_{r+1}...n_{r+s}}e[-n_1, ..., -n_r]f[-n_{r+1}, ..., n_{r+s}]w_2^{(0)}\\
    & \qquad \qquad \qquad \qquad \qquad \qquad \qquad \cdot x^{n_1+\cdots +n_{r+s}+wt(w_2^{(0)})-wt(w_\lambda^{(1)})-1}
\end{align*}
\begin{rema}
    \begin{enumerate}
        \item Currently I have not found any way to control $r$ and $s$. One promising direction is to investigate the further conditions of the composability condition. 
        \item  The Jacobi identity with respect to $h(-1)$-action seems to hold without trouble (not yet fully written down). But I am uncertain if this choice exhausts all the intertwining operators of type $\binom{W_2}{VW_1}$. 
    \end{enumerate}
\end{rema}

\section{Computation of a simple example}

Consider the case when $2/l \notin \Z$. Assume that $w_1^{(0)}\in W_1, w_2^{(0)}\in W_2$ are the highest weight vectors in the top space, with $wt_h(w_2^{(0)}) = wt_h(w_1^{(0)}) + 4$. This choice is motivated by the level-1 extension example where $w_1^{(0)} = \one, w_2^{(0)} = e(-1)^2\one$. But we assumed that $2/l\notin \Z$. So conclusions do not apply to the level-1 case. 

We take the simplest ansatz with
$$(e_\alpha(-1)\one)_0 w_1^{(0)} = \sum_{m\geq 0} C_m f[-m]w_2^{(0)}$$
So, 
$$\Y(e_\alpha(-1)\one, x)w_1^{(0)} = \sum_{m\geq 0} C_m E^-(-\alpha, x) f[-m]w_2^{(0)} x^{wt(w_2^{(0)})-wt(w_1^{(0)})+m-1}$$
The composability condition requires that 
$$Y_{W_2}(e_\beta(-1)\one, x) \Y(e_\alpha(-1)\one, y)w_1^{(0)}$$ 
to converge to a $\overline{W_2}$-valued rational function. We compute this series for $e_\alpha = e_\beta = e$
\begin{align*}
    & Y_{W_2}(e(-1)\one, x) \Y(e(-1)\one, y)w_1^{(0)}\\
    = \ & \sum_{m\geq 0} C_m e(x) E^-(-h, y) f[-m]w_2^{(0)} y^{wt(w_2^{(0)})-wt(w_1^{(0)})+m-1}\\
    = \ & \left(1-\frac y x\right)^{2/l}\sum_{m\geq 0} C_m  E^-(-h, y) e(x) f[-m]w_2^{(0)} y^{wt(w_2^{(0)})-wt(w_1^{(0)})+m-1}\\
    = \ & \left(1-\frac y x\right)^{2/l}\sum_{m\geq 0} C_m  E^-(-h, y) \sum_{k\geq 0} (-1)^{k} \binom{2/l}{k} E^-(-h,x) \sum_{n\in \Z}e[n]f[k-m]w_2^{(0)} x^{-n-k-1}y^{wt(w_2^{(0)})-wt(w_1^{(0)})+m-1}\\
    = \ & \left(1-\frac y x\right)^{2/l}\sum_{k\geq 0}\sum_{m\geq k} C_m  E^-(-h, y)  (-1)^{k} \binom{2/l}{k} E^-(-h,x) \sum_{n\in \Z}e[n]f[k-m]w_2^{(0)} x^{-n-k-1}y^{wt(w_2^{(0)})-wt(w_1^{(0)})+m-1}\\
    = \ & \left(1-\frac y x\right)^{2/l}\sum_{k\geq 0}\sum_{m\geq 0} C_{m+k}  E^-(-h, y)  (-1)^{k} \binom{2/l}{k} E^-(-h,x) \sum_{n\in \Z}e[n]f[-m]w_2^{(0)} x^{-n-k-1}y^{m+k}y^{wt(w_2^{(0)})-wt(w_1^{(0)})-1}
\end{align*}
If we pair with the dual of the vacuum vector $e[-p]f[-q]w_2^{(0)}$, then $E^-$-operators are all gone. What remains is 
\begin{align*}
    & \left(1-\frac y x\right)^{2/l}\sum_{k\geq 0} C_{m+k}  (-1)^{k} \binom{2/l}{k}  x^{p-k-1}y^{q+k}y^{wt(w_2^{(0)})-wt(w_1^{(0)})-1}\\
    = \ & \left(1-\frac y x\right)^{2/l} \left(\sum_{k\geq 0} C_{q+k}  (-1)^{k} \binom{2/l}{k}  x^{-k-1}y^{k}\right)x^{-p}y^{q+wt(w_2^{(0)})-wt(w_1^{(0)})-1}
\end{align*}
Since $2/l\notin \Z$, it is necessary for the series  
$$\sum_{k\geq 0} C_{q+k}  (-1)^{k} \binom{2/l}{k}  x^{-k-1}y^{k}$$
to be the expansion of a finite linear combination of 
$$\left(1-\frac y x\right)^{-2/l-M}.$$
This property should also hold for every $q\geq 0$. 

In particular, for $q=0$, then 
$$C_{k}(-1)^{k} \binom{2/l}{k} = \text{ a finite linear combination of }(-1)^k \binom{-2/l-M}{k} $$
So generally, 
$$(-1)^k C_{k+q}\binom{2/l}{k} = \text{ a finite linear combination of } (-1)^k \displaystyle{\frac{\binom{-2/l-M}{k+q}\binom{2/l}{k}}{\binom{2/l}{k+q}}}$$
In this case, the series in question converges to a finite linear combination of hypergeometric functions 
$${}_2F_1\left(-\frac 2 l, \frac 2 l + M + q, - \frac 2 l + q; \frac y x\right)$$
I checked with mathematica that found that 
$$(1-y/x)^{2/l}{}_2F_1\left(-\frac 2 l, \frac 2 l + M + q, - \frac 2 l + q; \frac y x\right)$$
generally fails to be a meromorphic function for $q>0$. Therefore, $C_m = 0$ for every $m\geq 0$. 

\begin{rema}
    The above argument works only when $2/l\notin \Z$. When $2/l\in \Z$, taking all $C_m = 1$ would work. 
\end{rema}
\begin{thebibliography}{KWAK2}

\bibitem[Q1]{Q-Ext-1} Fei Qi, On the extensions ...

\bibitem[Li]{Li-Abel-Coset} Haisheng Li, On abelian coset generalized vertex algebras, ...

\end{thebibliography}




\end{document}

